# Habit Tracker PWA

## Overview

Single-page Progressive Web App for tracking daily habits and habit groups. Fully offline-capable, installable on mobile, all data in `localStorage`. Deployed to GitHub Pages.

## Project Structure

```
habit_tracking/
├── index.html       # Full app (HTML + CSS + JS inline)
├── sw.js            # Service Worker (cache-first, version: habit-tracker-v2)
├── manifest.json    # PWA manifest (standalone, portrait, purple theme)
├── icon-192.png     # App icon 192×192
├── icon-512.png     # App icon 512×512
└── README.md
```

## Architecture

- **Single file app**: All HTML, CSS, JS in `index.html` — no build tools, no frameworks
- **localStorage**: Key `habit_tracker_data`, stores `{ settings, items[] }` as JSON
- **Service Worker** (`sw.js`): Cache-first. Cache name: `habit-tracker-v2` — bump to force refresh
- **PWA manifest**: Standalone display, portrait, theme `#6C3CE1`, bg `#0f0f1a`

## Data Model

```json
{
  "settings": { "resetHour": 2 },
  "items": [
    { "id": "...", "type": "habit", "name": "...", "completed": ["YYYY-MM-DD"] },
    {
      "id": "...", "type": "group", "name": "...", "completed": ["YYYY-MM-DD"],
      "children": [{ "id": "...", "name": "...", "completed": ["YYYY-MM-DD"] }]
    }
  ]
}
```

- **`settings.resetHour`**: 0–23, when the "day" rolls over (default 0 = midnight)
- **Group `completed`**: dates where master checkbox was tapped
- **Child `completed`**: individual completion dates
- Old format (`{ habits: [...] }`) auto-migrates on first load

## Key Features

| Feature | Implementation |
|---|---|
| Habit Groups | `type: "group"` items with `children[]` array |
| Master checkbox | Toggles all children + group `completed` |
| Auto-complete group | When all children checked, group auto-completes |
| Auto-hide completed | Completed items get `hiding` CSS class; toggle via "Show completed" button |
| All-done celebration | Shown when all items done and `showCompleted` is false |
| Detail view | Fullscreen overlay with stats cards, 3-month heatmap (most recent first), per-child breakdown. Tapping group children opens their own detail view. |
| Custom reset hour | `getEffectiveDate()` checks `settings.resetHour` vs current hour |
| Reorder mode | ↕️ button toggles `reorderMode`; shows ▲/▼ arrows on items; `moveItem()` swaps in data array |
| Edit mode | ✏️ button opens add modal pre-filled with item data; `editingId` tracks which item is being edited |
| Streak (habit) | `calcStreak()` — consecutive days in `completed[]` |
| Streak (group) | `calcGroupStreak()` — consecutive days all children done |
| Perfect day streak | `calcPerfectDayStreak()` — consecutive days every item done |
| Settings modal | Gear icon in header, saves `resetHour` |

## Functions (in `<script>`)

| Function | Purpose |
|---|---|
| `generateId()` | Unique ID (timestamp + random) |
| `getEffectiveDate(settings)` | Today's date string adjusted for `resetHour` |
| `load()` / `save(data)` | localStorage read/write with migration |
| `calcStreak(dates, settings)` | Consecutive-day streak for a habit |
| `calcGroupStreak(item, settings)` | Group streak (all children done) |
| `calcPerfectDayStreak(data)` | All-items-done streak |
| `isGroupDoneOnDate(item, date)` | Check if group fully done on a date |
| `isAllDoneOnDate(items, date)` | Check if every item done on a date |
| `last7Days()` / `last7DaysGroup()` | 7-day completion booleans for dot display |
| `render()` | Full re-render of habit list + stats |
| `toggleHabit(id)` | Toggle standalone habit completion |
| `toggleGroup(id)` | Master toggle — complete/uncomplete group + all children |
| `toggleChild(groupId, childId)` | Individual child toggle (auto-completes group if all done) |
| `deleteItem(id)` / `deleteChild()` | Delete with confirmation |
| `showDetail(id)` | Opens fullscreen detail view for a habit or group |
| `showChildDetail(groupId, childId)` | Opens detail view for an individual child within a group |
| `calcBestStreak(dates)` | Finds longest consecutive run in completion history |
| `calcCompletionRate(dates, settings)` | Percentage of days completed since first completion |
| `buildHeatmapHtml(dates, settings)` | Generates 3-month calendar heatmap grid HTML |
| `getCompletedDatesForItem(item, settings)` | Gets all effective completion dates (groups: all-children-done dates) |
| `toggleReorderMode()` | Toggles reorder mode on/off |
| `moveItem(id, direction)` | Swaps item with neighbor in data array (-1=up, +1=down) |
| `editItem(id)` | Opens modal pre-filled with item data for editing |
| `setAddType(type)` | Switch add modal between habit/group mode |
| `addChildTag()` / `removeChildTag()` | Manage group children in add modal |

## Design System

- **Font**: Inter (Google Fonts)
- **Theme**: Dark glassmorphism — `--bg: #0f0f1a`, `--surface: #1a1a2e`, `--accent: #6C3CE1`, `--green: #22c55e`
- **Animations**: Pop on check, slideUp modal, scale-on-press, fade-out on hide
- **Border radius**: 16px (cards), 12px (inputs, child items)

## Deployment

- **GitHub Pages**: `https://abdokaseb.github.io/habit-tracker/`
- **Repo**: `https://github.com/abdokaseb/habit-tracker.git`
- **Branch**: `main`, root folder
- To update: push to `main`
- To force SW update: bump `CACHE_NAME` in `sw.js`

## Development

- No build step — edit `index.html` directly
- Local: `python -m http.server 8080`
- PWA install requires HTTPS (GitHub Pages provides this)
